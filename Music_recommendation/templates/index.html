<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>LoFi MoodPlayer ‚Äî Emotion & Gesture Music</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="app-shell">
        <header class="navbar">
            <div class="brand-row">
                <div class="brand">LoFi MoodPlayer</div>
                <div class="tag">Emotion-aware, gesture-controlled music</div>
            </div>

            <div class="nav-actions">
                <button id="themeToggle" class="icon-btn" title="Toggle theme">üåó</button>
            </div>
        </header>

        <main class="container">
            <section class="main-content">
                <div class="detection-area loft">
                    <div class="video-wrap">
                        <video id="video" autoplay playsinline muted></video>
                    </div>
                    
                    <div class="train-stack">
                        <div class="card video-mini">
                            <video id="videoTrain" autoplay playsinline muted></video>
                        </div>
                        <div class="card">
                            <div class="small muted">Train Face Samples</div>
                            <select id="trainLabel" style="width:100%; padding:8px; margin: 8px 0; border-radius: 6px; border: var(--border); background: var(--surface); color: var(--text-color);">
                                <option value="Happy">Happy</option>
                                <option value="Sad">Sad</option>
                                <option value="Angry">Angry</option>
                                <option value="Neutral">Neutral</option>
                            </select>
                            <button id="captureTrainBtn" class="ghost small" style="width:100%">Capture Current Face</button>
                            <div id="trainStatus" class="small muted" style="text-align:center; margin-top:5px;">Train Ready</div>
                        </div>
                    </div>
                </div>

                <div class="controls-panel">
                    <div class="control-row">
                        <button id="autoDetectBtn" class="control-btn">
                            Mood/Gesture Auto-Detect: <span id="autoState">Off</span>
                        </button>
                        <div id="status" class="status">System Status: Waiting for Camera...</div>
                    </div>
                    
                    <div class="control-row" style="margin-bottom: 0;">
                        <div id="gestureStatus" class="status" style="flex: 1;">Hand Gesture: **None**</div>
                        <div id="spotifyAuthStatus" class="status small" style="flex: 1; border: 1px solid var(--danger);">Spotify: **Logged Out**</div>
                    </div>

                    <div class="emotion-result card" style="margin-top:20px;">
                        <div>
                            <div id="emotionText" class="emotion-text">Detected Mood: -</div>
                            <div id="confidenceText" class="confidence-text">Confidence: -</div>
                        </div>
                        <div id="langButtons" class="lang-row">
                            <button class="lang-btn" data-lang="Hindi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
                            <button class="lang-btn" data-lang="Kannada">‡≤ï‡≤®‡≥ç‡≤®‡≤°</button>
                            <button class="lang-btn" data-lang="Telugu">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
                            <button class="lang-btn" data-lang="English">English</button>
                        </div>
                    </div>

                    <div id="songsArea" class="songs-area">
                        <div class="small muted">Select a language after mood detection to see song recommendations.</div>
                    </div>
                    
                    <div id="spotifyPlayerInterface" class="hidden">
                        <div class="player-info">
                            <span class="small muted">Now Playing: </span>
                            <strong id="trackName">N/A</strong>
                            <span class="small muted"> by </span>
                            <span id="artistName" class="small">N/A</span>
                        </div>
                        <div id="playbackStatus" class="small" style="margin-top: 5px;"></div>
                        <div class="track-bar" id="trackBar">
                            <div class="track-progress" id="trackProgress"></div>
                        </div>
                        <div class="player-controls">
                            <button class="player-btn" id="playPauseBtn" title="Play/Pause">‚èØÔ∏è</button>
                            </div>
                    </div>
                </div>
            </section>

            <aside class="sidebar">
                <div class="avatar-card">
                    <div id="avatarShell" class="avatar-shell neutral">
                        <div class="face">
                            <div class="eye left"></div>
                            <div class="eye right"></div>
                            <div class="mouth"></div>
                            <div class="tear"></div>
                        </div>
                    </div>
                    <div class="avatar-meta">
                        <div id="avatarEmotion" class="avatar-emotion">Awaiting Mood...</div>
                        <div class="avatar-sub">Real-time reaction</div>
                    </div>
                </div>

                <div class="graph-card card">
                    <div class="graph-head">
                        <div class="title">Realtime Mood Graph</div>
                        <div class="subtitle small muted">Confidence (%) over time</div>
                    </div>
                    <canvas id="moodChart" height="160"></canvas>
                </div>
                
                <div class="info-card card">
                    <div class="info-title">Quick Guide & Actions</div>
                    <div class="user-guide-section small muted">
                        <p class="guide-item">
                            **Spotify Login:** <a href="/login" id="spotifyLoginLink">Click here</a> to log in for music streaming.
                        </p>
                        <p class="guide-item">
                            **Mood Detection:** Use **Auto-Detect** for continuous mood/gesture scanning.
                        </p>
                        <p class="guide-item">
                            **Hand Gestures (Automatic):**<br>
                            ‚úã: **Play** | ‚úä: **Pause**
                        </p>
                    </div>

                    <div class="action-list" style="margin-top: 15px;">
                        <button id="datasetBtn">Dataset Info</button>
                        <button id="resetBtn" class="danger">Reset Dataset</button>
                    </div>
                </div>
            </aside>
        </main>

        <footer class="footer">
            <div class="footer-left small muted">Tip: Use a well-lit environment for best accuracy.</div>
            <div class="footer-right small muted">Face detection uses MediaPipe Face Mesh.</div>
        </footer>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>